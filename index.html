<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Villa CABOUA</title>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<style>
body {font-family: Arial; margin:0; background:#f5f5f5;}
section {padding:60px;}
#calendar {max-width:1000px;margin:auto;}
button {padding:15px 30px;font-size:18px;background:#2c3e50;color:white;border:none;border-radius:8px;margin-top:20px;}
#total {font-size:22px;margin-top:20px;text-align:center;}
</style>
</head>
<body>

<section>
<h2 style="text-align:center;">DisponibilitÃ©s</h2>
<div id="calendar"></div>
<div id="total"></div>
<div style="text-align:center;">
<button id="payer" style="display:none;">ðŸ’³ Payer maintenant</button>
</div>
</section>

<script>
let selectedStart = null;
let selectedEnd = null;
const TARIF = 180;

document.addEventListener('DOMContentLoaded', function() {

  const calendar = new FullCalendar.Calendar(
    document.getElementById('calendar'),
    {
      initialView: 'multiMonth',
      views: {
        multiMonth: {
          type: 'multiMonth',
          duration: { months: 2 }
        }
      },
      locale:'fr',
      selectable:true,
      select:function(info){

        selectedStart = info.startStr;
        selectedEnd = info.endStr;

        const start = new Date(selectedStart);
        const end = new Date(selectedEnd);
        const nights = Math.ceil((end-start)/(1000*60*60*24));

        if(nights < 5){
          alert("Minimum 5 nuits");
          return;
        }

        const total = nights * TARIF;

        document.getElementById("total").innerHTML =
          "Total : " + total + " â‚¬ (" + nights + " nuits)";

        document.getElementById("payer").style.display="inline-block";
      }
    });

  calendar.render();
});

document.getElementById("payer").addEventListener("click", async function(){

  const response = await fetch("/create-checkout-session",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      startDate:selectedStart,
      endDate:selectedEnd
    })
  });

  const data = await response.json();
  window.location = data.url;
});
</script>

</body>
</html>
